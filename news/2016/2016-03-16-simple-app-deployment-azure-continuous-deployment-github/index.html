<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">

    <title>Simple App Deployment with Azure Continuous Deployment and GitHub - Exceptionless</title>

    <meta name="description" content="Real-time exception reporting for ASP.NET, Web API, WebForms, WPF, Console, and MVC applications. Includes event organization, notifications, and more.">
    <meta name="robots" content="index,follow">
    <meta name="author" content="[object Object]">

    <link rel="canonical" href="NaN">

    <!-- opengraph -->
    <meta property="og:title" content="Simple App Deployment with Azure Continuous Deployment and GitHub - Exceptionless">
    <meta property="og:type" content="article">
    <meta property="og:url" content="NaN">
    <meta property="og:description" content="Real-time exception reporting for ASP.NET, Web API, WebForms, WPF, Console, and MVC applications. Includes event organization, notifications, and more.">
    <meta property="og:image" content="undefined/undefined/undefined">
    <!-- end opengraph -->

    <!-- twitter -->
    <meta name="twitter:card" content="summary"><meta name="twitter:site" content="@Exceptionless">
    <meta name="twitter:url" content="NaN">
    <meta name="twitter:title" content="Simple App Deployment with Azure Continuous Deployment and GitHub - Exceptionless">
    <meta name="twitter:description" content="Real-time exception reporting for ASP.NET, Web API, WebForms, WPF, Console, and MVC applications. Includes event organization, notifications, and more.">
    <meta name="twitter:image" content="undefined/undefined/undefined">
    <!-- end twitter -->

    <!-- google tag manager -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-433340-8"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-433340-8');
    </script>
    <!-- end google tag manager -->

    <link rel="alternate" href="/website/feed.xml" type="application/atom+xml" title="Exceptionless">
    <link rel="alternate" href="/website/feed.json" type="application/json" title="Exceptionless">
    <link rel="shortcut icon" href="/website/favicon.ico">

    <link rel="stylesheet" href="/website/assets/cyclone-slider-pro/templates/standard/style.css">
    <link rel="stylesheet" href="/website/assets/css/theme.css">
    <link rel="stylesheet" href="/website/assets/css/responsive.css">

    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400italic,600italic,300,400,600" rel="stylesheet">

    <link href="https://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
    <link href="/website/assets/css/prism.css" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>

    <link rel="stylesheet" href="/website/assets/css/custom.css">
  </head>
  <body class="home page custom-background top-navbar">
    <header id="banner" class="topnavbar navbar navbar-fixed-top" role="banner">
        <div class="navbar-inner">
            <div class="container">
                <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </a>
                <a class="brand" href="/website/">
                    <img id="site-logo" src="/website/assets/img/exceptionless-logo1.png" alt="Exceptionless - .NET Exception Reporting">
                </a>
                <nav id="nav-main" class="nav-main nav-collapse collapse" role="navigation">
                    <ul id="menu-primary-navigation" class="nav pull-right"><li class="menu-tour"><a href="/website/tour/">Tour</a></li>
                        <li class="menu-why"><a href="/website/why/">Why?</a></li>
                        <li class="menu-pricing"><a href="/website/pricing/">Pricing</a></li>
                        <li class="menu-news"><a href="/website/news/">News</a></li>
                        <li class="menu-help"><a href="/website/docs/">Docs</a></li>
                        <li class="menu-log-in"><a href="https://be.exceptionless.io">Log In</a></li>
                        <li class="menu-sign-up"><a href="https://be.exceptionless.io/signup?domain=www.codesmithtools.com&amp;type=organic">Sign Up</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div id="megaDrop" class="container-fluid top-megamenu"><div class="container"><div class="row"></div></div></div>
    </header>

    
      
<div class="page-header margin-top">
  <h1>News</h1>
</div>

<div id="wrap" class="container" role="document">
  <div id="content" class="row-fluid">
    <div id="main" class="span12" role="main">
      
        <article class="post type-post status-publish format-standard hentry category-uncategorized tag-net tag-updates">
          <header>
            <h1 class="entry-title">Simple App Deployment with Azure Continuous Deployment and GitHub</h1>
          </header>
          <div class="entry-content">
            <p><img src="/website/assets/img/news/cloud-icon.png" alt="simple app deployment">We’ve learned a lot about simple app deployment since we first started Exceptionless. We initially went with what everyone else was doing (Octopus Deploy), but over time we thought we could greatly simplify and automate it, letting us focus on what matters, improving the product!</p>
<p>Through a lot of testing and iterations of our deployment process, we think we finally nailed it.</p>
<p>As such, we’d like to share with the community how we use Microsoft Azure Continuous Deployment and GitHub for **awesomely simple deployments.&nbsp;**And, how you can too. See the details of implementing this deploy workflow later in the article, below.<!--more--></p>
<h2>Exceptionless Deployment History</h2>
<h3>In the Beginning</h3>
<p>When we first started Exceptionless, we deployed it as a monolithic application, meaning the server and UI&nbsp;were&nbsp;one piece, or app. We used Octopus Deploy to deploy to a single IIS machine, which involved setting up a website and server for the Octopus Deploy service and configuring build agents, on each server we deployed to, that could deploy build artifacts.</p>
<h3>The Move to Azure</h3>
<p>After a year or so of managing Exceptionless on colocation boxes in a Dallas data center, we realized that <strong>we didn’t want to manage hardware anymore</strong> and we could scale easier on a managed service like Azure. So, we moved to Azure, where we&nbsp;had to set up a VM just to manage&nbsp;deployments with Octopus Deploy. There were also issues that we ran into with deploying to Azure WebSitThis was annoying, since every time we wanted to do a release we had to log in and tell the system to deploy to production.</p>
<p>We knew there had to be a better way.</p>
<h3>Two Steps Forward...</h3>
<p>Soon, we decided to split the UI and Server apps so we could deploy and work on them independently. This also meant they could scale independently and one change to either wouldn’t cause the whole site to go down when deploying. Splitting the two&nbsp;helped a lot, but it <strong>added more work</strong> as we now had to manage two Octopus Deploy projects. So, we started looking at the <a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-publish-source-control/" target="_blank">Continuous Deployment in Azure</a>.</p>
<h3>Aha! Eureka! Solution Time!</h3>
<p>We researched further and found out that if we used <a href="https://github.com/nvie/gitflow" target="_blank">Git Flow</a> as a development workflow, we could ditch Octopus Deploy completely, remove that dependency, and just use Git push to manage our deployments.</p>
<p>With Git Flow, you do all your work in feature branches and the <strong>master branch is always stable</strong>. This allows us to set up GitHub deployment on the master and deploy&nbsp;to Azure automatically, with no work required! So anytime we push to the GitHub master branch, it automatically deploys to production on Azure. That simple!</p>
<h4>Here is the BASIC workflow:</h4>
<ol>
<li>We create a new feature branch, then work on that branch until it is completed and tested. Testing is done on the website that is currently pointed to the feature branch, which is separate from production.</li>
<li>When we commit to any branch, our continuous integration (CI) server picks up the changes via a GitHub webhook, pulls them down, then builds the project.</li>
<li>We then take all of the build artifacts and push them to a second GitHub repository using the same branch that the code was pushed to (for example, the master branch). This allows you to see exactly what artifacts change between releases (stateless too) and different branches.</li>
<li>Those changes are then automatically pushed via Azure Git Deploy.</li>
<li>Profit!</li>
</ol>
<p><strong>This is very slick!</strong> Since we push artifacts to the same branch they were built onto a build repository. We can then set up different environments that get auto deployed when we push to that branch. For example: When we are working on a feature,&nbsp;we commit to our branch. We can then set up a new website in Azure that&nbsp;pulls from the build server’s Git artifacts branch for that feature. This allows us to test and automate environments!</p>
<h2>Detailed&nbsp;Continuous Deployment Setup</h2>
<p>Here are the details on our solution for simple app deployment using GitHub and Azure.</p>
<h3>1.&nbsp;Use AppVeyor to build the app.</h3>
<h3>2. Store build artifacts in a separate GitHub artifacts repository.</h3>
<p>This works really well because you can see the entire history of your build artifacts and browse their contents. Plus, GitHub hosts it for free!</p>
<p>We found that we could that GitHub could understand and parse into different links. We can click on the "Commit:" part of the message to link to the actual commit that is building to see exactly has changed.</p>
<p><img src="/website/assets/img/news/github-build-history-artifacts-1024x380.jpg" alt="github build history artifacts"></p>
<p>We can then click on the build to see what artifacts changed.</p>
<p><img src="/website/assets/img/news/gitHube-build-history-details-1024x193.jpg" alt="gitHub build history details"></p>
<p>Another great thing about using Git to store your artifacts is that you can easily clone the artifacts to your local machine to see the exact files that are being used in a specific environment.</p>
<p>The artifacts repository has branches to match the branches of our code repo so we have separate build artifacts for each branch. This also means that we can just merge the feature into master when we are done and that will cause the production website that is pointed to our master repository to automatically get updated. So, it’s as simple as merge your branch to master to promote a build to production.</p>
<p><img src="/website/assets/img/news/merge-branch-master-promote-build-production.jpg" alt="merge-branch-master promote build production"></p>
<p><strong>One issue</strong> with this approach is that the repo can get large because we are storing binary files that change on every build. We are looking into using <a href="https://git-lfs.github.com/">Git Large File Support</a> to fix this issue.</p>
<h3>3.&nbsp;Automate pushing of artifacts to a secondary GitHub repository.</h3>
<p>For our .NET application, <a href="https://github.com/exceptionless/Exceptionless" target="_blank">Exceptionless</a>, we invoke a PowerShell script on post build to clone and commit the changes to the <a href="https://github.com/exceptionless/Exceptionless/blob/master/Libraries/Push-Artifacts.ps1" target="_blank">Git artifacts repository</a>.</p>
<ol>
<li>Our first step is to <a href="https://github.com/exceptionless/Exceptionless/blob/master/Libraries/Push-Artifacts.ps1#L10-L11" target="_blank">clone the existing build artifacts repo to an artifacts directory</a>.</li>
<li>Next, we <a href="https://github.com/exceptionless/Exceptionless/blob/master/Libraries/Push-Artifacts.ps1#L20-L28" target="_blank">change to the same branch that we are currently building, if it doesn’t exist we create it</a>.</li>
<li>Then, we <a href="https://github.com/exceptionless/Exceptionless/blob/master/Libraries/Push-Artifacts.ps1#L35-L36" target="_blank">remove all existing files in the artifacts folder</a>. This ensures we don’t have any conflicts and we can see exactly what was added or removed.</li>
<li>Next, we <a href="https://github.com/exceptionless/Exceptionless/blob/master/Libraries/Push-Artifacts.ps1#L38-L60" target="_blank">copy our build artifacts into the artifacts folder</a>. This allows us fine grained control over our artifacts.</li>
<li>Next,&nbsp;we&nbsp;<a href="https://github.com/exceptionless/Exceptionless/blob/master/Libraries/Push-Artifacts.ps1#L62-L67" target="_blank">try to&nbsp;commit all artifacts to the artifacts repository</a>. If there were no changes between the last build, then we exit.</li>
<li>Next, we <a href="https://github.com/exceptionless/Exceptionless/blob/master/Libraries/Push-Artifacts.ps1#L69-L78" target="_blank">push the artifacts to our GitHub artifacts repository</a>, which will then trigger Azure Continuous Deployment to pick up the changes.</li>
<li>Finally, we <a href="https://github.com/exceptionless/Exceptionless/blob/master/Libraries/Push-Artifacts.ps1#L80-L87" target="_blank">create tag the artifacts repository</a> which points to the specific GitHub commit we are building in our main repository.</li>
</ol>
<p><strong>For our static <a href="https://github.com/exceptionless/Exceptionless.UI" target="_blank">Angular JavaScript app (UI)</a>,</strong> we invoke a <a href="https://github.com/exceptionless/Exceptionless.UI/blob/master/src/Gruntfile.js#L51" target="_blank">Grunt publish task</a> from our post build event. The publish task called into a <a href="https://github.com/tschaub/grunt-gh-pages" target="_blank">gh-pages</a>&nbsp;<a href="https://github.com/exceptionless/Exceptionless.UI/blob/master/src/grunt/task-configs/gh-pages.js" target="_blank">task</a>&nbsp;that&nbsp;publishes our built dist folder to the GitHub artifacts repository automatically.</p>
<h3>4. Point Azure Continuous Deployment to the Artifacts Repository</h3>
<p>It will see when new artifact commits happen and automatically deploy the changes.</p>
<p><img src="/website/assets/img/news/azure-sees-new-artifact-commit-and-deploys-1024x846.jpg" alt="azure sees new artifact commit and deploys"></p>
<p>Azure Continuous Deployment is another Git repository that we can easily view to see the history of deployments to each of our sites. It also allows us to easily roll back to previous versions.</p>
<h3>5. Use Environment Variables to Override Config Settings Per Environment</h3>
<p>Azure Websites makes this very easy.</p>
<p><img src="/website/assets/img/news/override-config-settings-environment-variables-1024x497.jpg" alt="azure override config settings environment variables"></p>
<p>No production settings are stored in source control or artifacts repository.</p>
<p>For our ASP.NET application, our settings class will look up named settings in the following order:</p>
<ol>
<li>environment variables</li>
<li>local config.json file</li>
<li>app settings</li>
</ol>
<p>It will then fall back to a default value if no explicit settings are found.</p>
<p><strong>Configuring our static Angular JavaScript app</strong> is a bit more work since it can't look these settings up dynamically at runtime. So instead we add some code to our deployment process.</p>
<ul>
<li>Azure automatically runs a <a href="https://github.com/exceptionless/Exceptionless.UI/blob/master/deploy.sh" target="_blank">deploy.sh</a> file after getting the artifacts via git deploy. It’s sole job is to run a node script that rewrites our <a href="https://github.com/exceptionless/Exceptionless.UI/blob/master/src/app.config.js" target="_blank">app.config.js</a> settings with settings defined in environment variables.</li>
</ul>
<h2>Conclusion</h2>
<p>You can create multiple Azure websites (think environments) that use Continuous Deployment and point them to multiple artifact branches to support different environments!</p>
<p><strong>Pro Tip:</strong> We created a <a href="http://local-app.exceptionless.io">http://local-app.exceptionless.io</a> website for our spa website that’s pre-built and points to your localhost Exceptionless server. This allows us to do work on the server part without setting up or configuring a local instance of our spa app. Development made simple!</p>
<p>We won't&nbsp;lie, it took some work to get here, but <strong>the good news is you can do this really easily too</strong>. Please feel free to steal our deployment scripts and modify them for your projects. And let us know if you have questions along the way!</p>

          </div>
        </article>
            
    </div>
  </div>
</div>

    

    <div id="footer-wrapper">
        <footer id="content-info" class="container" role="contentinfo">
            <div class="row-fluid">
                <div class="span4"><section id="text-2" class="widget-1 widget-first widget widget_text"><div class="widget-inner">			<div class="textwidget"><h3><span class="slash">//</span> Quick Links</h3>
                    <ul class="footer-links clearfix">
                        <li><a href="/website/">Home</a></li>
                        <li><a href="/website/tour/">Tour</a></li>
                        <li><a href="/website/why/">Why?</a></li>
                        <li><a href="/website/pricing/">Pricing</a></li>
                        <li><a href="/website/news/">News</a></li>
                        <li><a href="/website/docs/">Docs</a></li>
                    </ul>
                    <ul class="footer-links clearfix">
                        <li><a href="javascript:Intercom('showNewMessage');">Contact</a></li>
                        <li><a href="https://github.com/exceptionless/Exceptionless" target="_blank" rel="noopener noreferrer">GitHub</a></li>
                        <li><a href="/website/about/">About Us</a></li>
                        <li><a href="/website/terms/">Terms of Use</a></li>
                        <li><a href="/website/privacy/">Privacy Policy</a></li>
                        <li>&nbsp;</li>
                    </ul></div>
                </div></section></div>
                <div class="span3"></div>
                <div class="span4"><section id="text-3" class="widget-1 widget-first widget widget_text"><div class="widget-inner">			<div class="textwidget"><h3><span class="slash">//</span> Stay In Touch</h3>
                    <p>There are real people behind Exceptionless, so if you have a question or suggestion (no matter how small) please get in touch with us:</p>

                    <ul class="social-icons-container">
                        <li>
                            <a href="https://twitter.com/exceptionless" target="_blank" class="social-icon social-icon-twitter" rel="noopener noreferrer">Twitter</a>
                        </li>
                        <li>
                            <a href="https://www.facebook.com/exceptionless" target="_blank" class="social-icon social-icon-facebook" rel="noopener noreferrer">Facebook</a>
                        </li>
                        <li>
                            <a href="https://github.com/exceptionless/Exceptionless" target="_blank" class="social-icon social-icon-github" rel="noopener noreferrer">GitHub</a>
                        </li>
                    </ul></div>
                </div></section></div>
            </div>
        </footer>
        <div class="copyrightContainer">
            <p class="copyright">© 2020 Exceptionless</p>
        </div>
    </div>

    <script src="/website/assets/js/main.js"></script>
    
    <!-- intercom -->
<script>
window.intercomSettings = {
    app_id: "6c0d76e0bec950052459f5cb4b727a949aeabbe1"
};
</script>

<script>
(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/6c0d76e0bec950052459f5cb4b727a949aeabbe1';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
</script>
<!-- end intercom -->

  

</body></html>